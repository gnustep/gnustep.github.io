
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>TimeMachine &#8212; GNUstep</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.1/css/all.min.css" />
  
  <!-- So that users can add custom icons -->
  <script src="../../../_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="../../../_static/documentation_options.js?v=f2a433a1"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Guides/App/3_TimeMachine/Staging';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">GNUstep</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../index.html">
    Guides
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../Manuals/index.html">
    Manuals
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../APIRefs/index.html">
    API references
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../About/index.html">
    About
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../Showcase/index.html">
    Showcase
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../index.html">
    Guides
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../Manuals/index.html">
    Manuals
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../APIRefs/index.html">
    API references
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../About/index.html">
    About
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../Showcase/index.html">
    Showcase
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">TimeMachine</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="timemachine">
<h1>TimeMachine<a class="headerlink" href="#timemachine" title="Link to this heading">#</a></h1>
<section id="single-window-application">
<h2><span id="AEN503">Single Window Application</span><a class="headerlink" href="#single-window-application" title="Link to this heading">#</a></h2>
<p>Single window application is one of the most commonly used application
type. Here, a TimeMachine application is made to demonstrate several
techniques of GNUstep programming.</p>
</section>
<hr class="docutils" />
<section id="outlet-and-action">
<h2><span id="AEN506">Outlet and Action</span><a class="headerlink" href="#outlet-and-action" title="Link to this heading">#</a></h2>
<p>I’ll write an application which show the current time with a button to
update. It looks like this:</p>
<p><span id="AEN509"></span></p>
<p><strong>Figure 4-1. Simple TimeMachine</strong></p>
<p><img alt="" src="../../../_images/OutletAction-01.jpg" /></p>
<p>This application is very easy. Just to show how to use “outlet” and
“action” in Gorm, and the relation between “controller” and “view”.</p>
<p>Open Gorm, choose “Document→New Application”, and build a window
with a title and a button.</p>
<p><span id="AEN516"></span></p>
<p><strong>Figure 4-2. Interface of simple TimeMachine</strong></p>
<p><img alt="" src="../../../_images/OutletAction-02.jpg" /></p>
<p>You can set the title of the button in the inspector. So does the title
of window.</p>
<p><span id="AEN522"></span></p>
<p><strong>Figure 4-3. Change title of button</strong></p>
<p><img alt="" src="../../../_images/OutletAction-03.jpg" /></p>
<p><img alt="" src="../../../_images/OutletAction-04.jpg" /></p>
<p>That’s all I need to do on the interface.</p>
<p>Now, I need an “controller” to receive the action from the “view”, and
display the time on the “view”. I need to create a object for this
“controller”.</p>
<p>First, I need to design the class of this “controller”. Click the
“classes” in the main window of Gorm.</p>
<p><span id="AEN533"></span></p>
<p><strong>Figure 4-4. Classes in Gorm</strong></p>
<p><img alt="" src="../../../_images/OutletAction-05.jpg" /></p>
<p>It will show all the classes you can use. I want the class of this
“controller” to inherit from NSObject. Therefore, choose “NSObject”,
then select the menu “Classes→Create Subclass…”. It will create a
new class under the NSObject.</p>
<p><span id="AEN539"></span></p>
<p><strong>Figure 4-5. Create subclass of NSObject</strong></p>
<p><img alt="" src="../../../_images/OutletAction-06.jpg" /></p>
<p>Double-click on it to change the name. I call it “Controller” here.
That’s the name of this class.</p>
<p><span id="AEN545"></span></p>
<p><strong>Figure 4-6. Change class name</strong></p>
<p><img alt="" src="../../../_images/OutletAction-07.jpg" /></p>
<p>Then I need a “outlet” in this class to connect to the label in the
window, and an “action” which is triggered when the button is press.</p>
<p>Choose the “Controller” class and click “Outlets” tab in the inspector.
Press “Add” button, and change the name to “label” by double-clicking
the “newOutlet”. You will notice that “Controller” class now has one
outlet. Click on the small round button will list the outlets it has.</p>
<p><span id="AEN552"></span></p>
<p><strong>Figure 4-7. Add outlet</strong></p>
<p><img alt="" src="../../../_images/OutletAction-19.jpg" /></p>
<p><img alt="" src="../../../_images/OutletAction-21.jpg" /></p>
<p>Now, click “Actions” tab and add a new action called “showCurrentTime:”.
You should notice that the action is ended with colon (:), which will be
explained later.</p>
<p><span id="AEN561"></span></p>
<p><strong>Figure 4-8. Add action</strong></p>
<p><img alt="" src="../../../_images/OutletAction-20.jpg" /></p>
<p><img alt="" src="../../../_images/OutletAction-22.jpg" /></p>
<p>Once I finish designing this class, I can create an instance from it.</p>
<p>Choose the class “Controller”, then select the menu
“Classes→Instantiate”. Look at the objects of Gorm main window. You
should find a new instance, called “Controller”. That’s the instance I
want to connect to the interface.</p>
<p><span id="AEN571"></span></p>
<p><strong>Figure 4-9. NSOwner</strong></p>
<p><img alt="" src="../../../_images/OutletAction-12.jpg" /></p>
<p>Now, I can connect the “controller” to the “view” for the outlet. Hold
on “Ctrl”, select the “Controller” instance, drag to the label in the
window. Look at the inspector, which will show all the outlet the
“Controller” instance has. Select the only one “label”, click the
“connect” button. That’s it.</p>
<p><span id="AEN577"></span></p>
<p><strong>Figure 4-10. Connect outlet</strong></p>
<p><img alt="" src="../../../_images/OutletAction-13.jpg" /></p>
<p><img alt="" src="../../../_images/OutletAction-14.jpg" /></p>
<p><img alt="" src="../../../_images/OutletAction-15.jpg" /></p>
<p>Again, I can connect the “view” to the “controller” for the action. Hold
on “Ctrl”, select the button in the window, drag to the “Controller”
instance. Look at the inspector, which will show all the outlet the
button has. Select the “target” in the outlet column, then select the
only one action the target has, “showCurrentTime”. Click the “connect”
button. That’s it.</p>
<p><span id="AEN589"></span></p>
<p><strong>Figure 4-11. Connect action</strong></p>
<p><img alt="" src="../../../_images/OutletAction-16.jpg" /></p>
<p><img alt="" src="../../../_images/OutletAction-17.jpg" /></p>
<p><img alt="" src="../../../_images/OutletAction-18.jpg" /></p>
<p>Finally, I need to create the files for this “Controller” class in order
to add the the source code. Otherwise, this class has not function at
all. Select the class “Controller” ( not the instance !) in the Gorm
main window. Choose menu “Classes→Create Class Files”. A “Save”
panel will show up and ask the filename. The default is “Controller.m”,
which is good enough. Click “O.K.”. Save this Gorm file as
“TimeMachine.gorm”, then leave Gorm.</p>
<p>Now, I have a directory, “TimeMachine.gorm”, and two file,
“Controller.h” and “Controller.m”.</p>
<p><code class="docutils literal notranslate"><span class="pre">Controller.h:</span></code></p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="cm">/* All Rights reserved */</span>

<span class="cp">#import &lt;AppKit/AppKit.h&gt;</span>

<span class="k">@interface</span> <span class="nc">Controller</span> : <span class="bp">NSObject</span>
<span class="p">{</span>
<span class="w">   </span><span class="kt">id</span><span class="w"> </span><span class="n">label</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">showCurrentTime:</span><span class="w"> </span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">sender</span><span class="p">;</span>
<span class="k">@end</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Controller.m:</span></code></p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="cm">/* All Rights reserved */</span>

<span class="cp">#import &lt;AppKit/AppKit.h&gt;</span>
<span class="cp">#import &quot;Controller.h&quot;</span>

<span class="k">@implementation</span> <span class="nc">Controller</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">showCurrentTime:</span><span class="w"> </span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">sender</span>
<span class="p">{</span>
<span class="w">   </span><span class="cm">/* insert your code here */</span>
<span class="p">}</span>
</pre></div>
</div>
<p>That’s the source code of the class “Controller” I just created in Gorm.
The method -showCurrentTime: has the message “sender”. That’s the reason
the action name in Gorm must has the colon (:) in the end. In the
“Controller.h”, you can find the outlet “label” and the action
“showCurrentTime:”. Therefore, whatever you do on the outlet “label”
will reflect to the “label” in the interface, and when the button “Get
Current Time” is pressed, the action -showCurrentTime: will be called.
That’s how the outlet and action work.</p>
<p>Now, I can put some source code in this class.</p>
<p><code class="docutils literal notranslate"><span class="pre">Controller.m:</span></code></p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="cm">/* All Rights reserved */</span>

<span class="cp">#import &lt;AppKit/AppKit.h&gt;</span>
<span class="cp">#import &quot;Controller.h&quot;</span>

<span class="k">@implementation</span> <span class="nc">Controller</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">showCurrentTime:</span><span class="w"> </span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">sender</span>
<span class="p">{</span>
<span class="w">   </span><span class="cm">/* insert your code here */</span>
<span class="w">  </span><span class="n">NSCalendarDate</span><span class="w"> </span><span class="o">*</span><span class="n">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">NSCalendarDate</span><span class="w"> </span><span class="n">date</span><span class="p">];</span>
<span class="w">  </span><span class="p">[</span><span class="n">date</span><span class="w"> </span><span class="n">setCalendarFormat</span><span class="o">:</span><span class="w"> </span><span class="s">@&quot;%H : %M : %S&quot;</span><span class="p">];</span>
<span class="w">  </span><span class="p">[</span><span class="n">label</span><span class="w"> </span><span class="n">setStringValue</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="n">date</span><span class="w"> </span><span class="n">description</span><span class="p">]];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>First, [NSCalendarDate date] will create an instance with the current
date and time. After setting the format, put the description of current
time into the outlet “label”. When users click the “Get Current Time”
button, it will show the current time.</p>
<p>That’s it. Add the main.m and GNUmakefile, then it is ready to go.</p>
<p><code class="docutils literal notranslate"><span class="pre">main.m:</span></code></p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="cp">#import &lt;AppKit/AppKit.h&gt;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span><span class="w"> </span>
<span class="p">{</span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">NSApplicationMain</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">GNUmakefile:</span></code></p>
<div class="highlight-makefile notranslate"><div class="highlight"><pre><span></span><span class="cp">include $(GNUSTEP_MAKEFILES)/common.make</span>

<span class="nv">APP_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>TimeMachine
<span class="nv">TimeMachine_HEADERS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Controller.h
<span class="nv">TimeMachine_OBJC_FILES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>main.m<span class="w"> </span>Controller.m
<span class="nv">TimeMachine_RESOURCE_FILES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>TimeMachineInfo.plist<span class="w"> </span>TimeMachine.gorm
<span class="nv">TimeMachine_MAIN_MODEL_FILE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>TimeMachine.gorm

<span class="cp">include $(GNUSTEP_MAKEFILES)/application.make</span>
</pre></div>
</div>
<p>In this example, the owner of the interface is NSApp, which is the
NSOwner in Gorm, but the controller is the “Controller” instance.
Sometimes, the owner and the controller could be the same. In simple
application, the owner/controller of the window can also be the delegate
of NSApp. That’s all depending on the design of your application.</p>
</section>
<hr class="docutils" />
<section id="custom-view">
<h2><span id="AEN622">Custom View</span><a class="headerlink" href="#custom-view" title="Link to this heading">#</a></h2>
<p>Gorm can work on the custom view, which is designed by the programmer,
not the built-in GUI component. Here, I continue my “time machine”
application to demonstrate how to do that. The new interface looks like
this:</p>
<p><span id="AEN625"></span></p>
<p><strong>Figure 4-12. TimeMachine with custom view</strong></p>
<p><img alt="" src="../../../_images/CustomView-11.jpg" /></p>
<p>Since I want to use the custom view in Gorm, I have to design the class
first. The custom view can inherit from NSView, or NSControl, depending
on what kind of functions you want. Actually, NSControl is a subclass of
NSView. So I will inherit from NSControl. Click on the small circle of
NSResponder to open its subclasses, then do the same thing on NSView and
NSControl. Now, you can see that many GUI component inherit from
NSControl, ex. NSTextField.</p>
<p><span id="AEN631"></span></p>
<p><strong>Figure 4-13. NSControl in Gorm</strong></p>
<p><img alt="" src="../../../_images/CustomView-01.jpg" /></p>
<p>I want my custom view, called “TimeView”, inherit from NSControl. Choose
“NSControl”, then select menu “Classes→Create Subclass…”.
Double-click to change the name.</p>
<p><span id="AEN637"></span></p>
<p><strong>Figure 4-14. Add subclass of NSControl</strong></p>
<p><img alt="" src="../../../_images/CustomView-02.jpg" /></p>
<p>You can notice that class “TimeView” also inherits 3 outlets and 7
actions from NSControl. Once the class “TimeView” is created, I can use
it as custom view.</p>
<p>Build the interface as below:</p>
<p><span id="AEN644"></span></p>
<p><strong>Figure 4-15. Interface with custom view</strong></p>
<p><img alt="" src="../../../_images/CustomView-03.jpg" /></p>
<p>Look at the “Attributes” in inspector of CustomView. Choose the class
“TimeView”.</p>
<p><span id="AEN650"></span></p>
<p><strong>Figure 4-16. Change class of custom view</strong></p>
<p><img alt="" src="../../../_images/CustomView-04.jpg" /></p>
<p>The “CustomView” becomes “TimeView”. That’s it !</p>
<p><span id="AEN656"></span></p>
<p><strong>Figure 4-17. Custom view with TimeView class</strong></p>
<p><img alt="" src="../../../_images/CustomView-05.jpg" /></p>
<p>As I did before, create another class for the “controller”. Add one
outlet for this “TimeView”, and one action for the button. I name the
outlet “timeView”.</p>
<p><span id="AEN662"></span></p>
<p><strong>Figure 4-18. Add outlet</strong></p>
<p><img alt="" src="../../../_images/CustomView-06.jpg" /></p>
<p><span id="AEN667"></span></p>
<p><strong>Figure 4-19. Add action</strong></p>
<p><img alt="" src="../../../_images/CustomView-07.jpg" /></p>
<p>Create an instance of class “Controller”. Connect the button to the
action “showCurrentTime”, and the outlet “timeView” to the custom view
“TimeView”.</p>
<p><span id="AEN673"></span></p>
<p><strong>Figure 4-20. Connect outlet</strong></p>
<p><img alt="" src="../../../_images/CustomView-08.jpg" /></p>
<p><img alt="" src="../../../_images/CustomView-09.jpg" /></p>
<p><img alt="" src="../../../_images/CustomView-10.jpg" /></p>
<p>Finally, create the class file for the classes “TimeView” and
“Controller”. Save this application as “TimeMachine.gorm”.</p>
<p>Now, I need to design the interface for the class “TimeView”. The class
“TimeView” is actually four NSTextField in a NSBox. The reason that I
made them in one class is because I can reuse it later on. Classes
inherited from NSView will be initialized by calling method
-initWithFrame:. Therefore, I only need to rewrite the method
-initWithFrame: in the class “TimeView”. Here are the files:</p>
<p><code class="docutils literal notranslate"><span class="pre">TimeView.h:</span></code></p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="cp">#import &lt;AppKit/AppKit.h&gt;</span>

<span class="k">@interface</span> <span class="nc">TimeView</span> : <span class="nc">NSControl</span>
<span class="p">{</span>
<span class="w">   </span><span class="n">NSTextField</span><span class="w"> </span><span class="o">*</span><span class="n">labelDate</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">labelTime</span><span class="p">;</span>
<span class="w">   </span><span class="n">NSTextField</span><span class="w"> </span><span class="o">*</span><span class="n">localDate</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">localTime</span><span class="p">;</span>
<span class="w">   </span><span class="n">NSCalendarDate</span><span class="w"> </span><span class="o">*</span><span class="n">date</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="n">NSCalendarDate</span><span class="w"> </span><span class="o">*</span><span class="p">)</span> <span class="nf">date</span><span class="p">;</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">setDate:</span><span class="w"> </span><span class="p">(</span><span class="n">NSCalendarDate</span><span class="w"> </span><span class="o">*</span><span class="p">)</span> <span class="nv">date</span><span class="p">;</span>

<span class="k">@end</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">TimeView.m:</span></code></p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="cp">#import &lt;AppKit/AppKit.h&gt;</span>
<span class="cp">#import &quot;TimeView.h&quot;</span>

<span class="k">@implementation</span> <span class="nc">TimeView</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span> <span class="nf">initWithFrame:</span><span class="w"> </span><span class="p">(</span><span class="n">NSRect</span><span class="p">)</span> <span class="nv">frame</span>
<span class="p">{</span>
<span class="w">   </span><span class="n">NSBox</span><span class="w"> </span><span class="o">*</span><span class="n">box</span><span class="p">;</span>

<span class="w">   </span><span class="nb">self</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nb">super</span><span class="w"> </span><span class="n">initWithFrame</span><span class="o">:</span><span class="w"> </span><span class="n">frame</span><span class="p">];</span>
<span class="w">   </span><span class="n">box</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[</span><span class="n">NSBox</span><span class="w"> </span><span class="n">alloc</span><span class="p">]</span><span class="w"> </span><span class="n">initWithFrame</span><span class="o">:</span><span class="w"> </span><span class="n">NSMakeRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">                                                  </span><span class="n">frame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">,</span>
<span class="w">                                                  </span><span class="n">frame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">)];</span>
<span class="w">   </span><span class="p">[</span><span class="n">box</span><span class="w"> </span><span class="n">setBorderType</span><span class="o">:</span><span class="w"> </span><span class="n">NSGrooveBorder</span><span class="p">];</span>
<span class="w">   </span><span class="p">[</span><span class="n">box</span><span class="w"> </span><span class="n">setTitlePosition</span><span class="o">:</span><span class="w"> </span><span class="n">NSAtTop</span><span class="p">];</span>
<span class="w">   </span><span class="p">[</span><span class="n">box</span><span class="w"> </span><span class="n">setTitle</span><span class="o">:</span><span class="w"> </span><span class="s">@&quot;Local Time&quot;</span><span class="p">];</span>

<span class="w">   </span><span class="n">labelDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[</span><span class="n">NSTextField</span><span class="w"> </span><span class="n">alloc</span><span class="p">]</span><span class="w"> </span><span class="n">initWithFrame</span><span class="o">:</span><span class="w"> </span><span class="n">NSMakeRect</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">45</span><span class="p">,</span><span class="w"> </span><span class="mi">35</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">)];</span>
<span class="w">   </span><span class="p">[</span><span class="n">labelDate</span><span class="w"> </span><span class="n">setStringValue</span><span class="o">:</span><span class="w"> </span><span class="s">@&quot;Date: &quot;</span><span class="p">];</span>
<span class="w">   </span><span class="p">[</span><span class="n">labelDate</span><span class="w"> </span><span class="n">setBezeled</span><span class="o">:</span><span class="w"> </span><span class="nb">NO</span><span class="p">];</span>
<span class="w">   </span><span class="p">[</span><span class="n">labelDate</span><span class="w"> </span><span class="n">setBackgroundColor</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="n">NSColor</span><span class="w"> </span><span class="n">windowBackgroundColor</span><span class="p">]];</span>
<span class="w">   </span><span class="p">[</span><span class="n">labelDate</span><span class="w"> </span><span class="n">setEditable</span><span class="o">:</span><span class="w"> </span><span class="nb">NO</span><span class="p">];</span>

<span class="w">   </span><span class="n">labelTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[</span><span class="n">NSTextField</span><span class="w"> </span><span class="n">alloc</span><span class="p">]</span><span class="w"> </span><span class="n">initWithFrame</span><span class="o">:</span><span class="w"> </span><span class="n">NSMakeRect</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">35</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">)];</span>
<span class="w">   </span><span class="p">[</span><span class="n">labelTime</span><span class="w"> </span><span class="n">setStringValue</span><span class="o">:</span><span class="w"> </span><span class="s">@&quot;Time: &quot;</span><span class="p">];</span>
<span class="w">   </span><span class="p">[</span><span class="n">labelTime</span><span class="w"> </span><span class="n">setBezeled</span><span class="o">:</span><span class="w"> </span><span class="nb">NO</span><span class="p">];</span>
<span class="w">   </span><span class="p">[</span><span class="n">labelTime</span><span class="w"> </span><span class="n">setBackgroundColor</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="n">NSColor</span><span class="w"> </span><span class="n">windowBackgroundColor</span><span class="p">]];</span>
<span class="w">   </span><span class="p">[</span><span class="n">labelTime</span><span class="w"> </span><span class="n">setEditable</span><span class="o">:</span><span class="w"> </span><span class="nb">NO</span><span class="p">];</span>

<span class="w">   </span><span class="n">localDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[</span><span class="n">NSTextField</span><span class="w"> </span><span class="n">alloc</span><span class="p">]</span><span class="w"> </span><span class="n">initWithFrame</span><span class="o">:</span><span class="w"> </span><span class="n">NSMakeRect</span><span class="p">(</span><span class="mi">55</span><span class="p">,</span><span class="w"> </span><span class="mi">45</span><span class="p">,</span><span class="w"> </span><span class="mi">130</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">)];</span>
<span class="w">   </span><span class="n">localTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[</span><span class="n">NSTextField</span><span class="w"> </span><span class="n">alloc</span><span class="p">]</span><span class="w"> </span><span class="n">initWithFrame</span><span class="o">:</span><span class="w"> </span><span class="n">NSMakeRect</span><span class="p">(</span><span class="mi">55</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">130</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">)];</span>

<span class="w">   </span><span class="p">[</span><span class="n">box</span><span class="w"> </span><span class="n">addSubview</span><span class="o">:</span><span class="w"> </span><span class="n">labelDate</span><span class="p">];</span>
<span class="w">   </span><span class="p">[</span><span class="n">box</span><span class="w"> </span><span class="n">addSubview</span><span class="o">:</span><span class="w"> </span><span class="n">labelTime</span><span class="p">];</span>
<span class="w">   </span><span class="p">[</span><span class="n">box</span><span class="w"> </span><span class="n">addSubview</span><span class="o">:</span><span class="w"> </span><span class="n">localDate</span><span class="p">];</span>
<span class="w">   </span><span class="p">[</span><span class="n">box</span><span class="w"> </span><span class="n">addSubview</span><span class="o">:</span><span class="w"> </span><span class="n">localTime</span><span class="p">];</span>
<span class="w">   </span><span class="n">RELEASE</span><span class="p">(</span><span class="n">labelDate</span><span class="p">);</span>
<span class="w">   </span><span class="n">RELEASE</span><span class="p">(</span><span class="n">labelTime</span><span class="p">);</span>
<span class="w">   </span><span class="n">RELEASE</span><span class="p">(</span><span class="n">localDate</span><span class="p">);</span>
<span class="w">   </span><span class="n">RELEASE</span><span class="p">(</span><span class="n">localTime</span><span class="p">);</span>

<span class="w">   </span><span class="p">[</span><span class="nb">self</span><span class="w"> </span><span class="n">addSubview</span><span class="o">:</span><span class="w"> </span><span class="n">box</span><span class="p">];</span>
<span class="w">   </span><span class="n">RELEASE</span><span class="p">(</span><span class="n">box</span><span class="p">);</span>

<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="nb">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="n">NSCalendarDate</span><span class="w"> </span><span class="o">*</span><span class="p">)</span> <span class="nf">date</span>
<span class="p">{</span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">date</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">setDate:</span><span class="w"> </span><span class="p">(</span><span class="n">NSCalendarDate</span><span class="w"> </span><span class="o">*</span><span class="p">)</span> <span class="nv">aDate</span>
<span class="p">{</span>
<span class="w">   </span><span class="n">ASSIGN</span><span class="p">(</span><span class="n">date</span><span class="p">,</span><span class="w"> </span><span class="n">aDate</span><span class="p">);</span>
<span class="w">   </span><span class="p">[</span><span class="n">date</span><span class="w"> </span><span class="n">setCalendarFormat</span><span class="o">:</span><span class="w"> </span><span class="s">@&quot;%a, %b %e, %Y&quot;</span><span class="p">];</span>
<span class="w">   </span><span class="p">[</span><span class="n">localDate</span><span class="w"> </span><span class="n">setStringValue</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="n">date</span><span class="w"> </span><span class="n">description</span><span class="p">]];</span>
<span class="w">   </span><span class="p">[</span><span class="n">date</span><span class="w"> </span><span class="n">setCalendarFormat</span><span class="o">:</span><span class="w"> </span><span class="s">@&quot;%H : %M : %S&quot;</span><span class="p">];</span>
<span class="w">   </span><span class="p">[</span><span class="n">localTime</span><span class="w"> </span><span class="n">setStringValue</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="n">date</span><span class="w"> </span><span class="n">description</span><span class="p">]];</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">dealloc</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">RELEASE</span><span class="p">(</span><span class="n">date</span><span class="p">);</span>
<span class="w">  </span><span class="p">[</span><span class="nb">super</span><span class="w"> </span><span class="n">dealloc</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">@end</span>
</pre></div>
</div>
<p>When Gorm generates the class files, it contains some default codes in
it. Since I don’t need any of them, they are safe to be removed. In
TimeView.h, I declare four NSTextField for display, and on
NSCalendarDate to store the date. I also declare two accessory methods
to set and get the date. In the -initWithFrame, one NSBox is set up, and
four NSTextField is put into it. And class “TimeView” is a subclass of
NSView, I add the NSBox as the subview of the class “TimeView”.</p>
<p>Other parts of this application should be very easy. Here are the files:</p>
<p><code class="docutils literal notranslate"><span class="pre">Controller.h:</span></code></p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="cp">#import &lt;AppKit/AppKit.h&gt;</span>
<span class="cp">#import &quot;TimeView.h&quot;</span>

<span class="k">@interface</span> <span class="nc">Controller</span> : <span class="bp">NSObject</span>
<span class="p">{</span>
<span class="w">   </span><span class="kt">id</span><span class="w"> </span><span class="n">timeView</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">showCurrentTime:</span><span class="w"> </span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">sender</span><span class="p">;</span>
<span class="k">@end</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Controller.m:</span></code></p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="cp">#import &lt;AppKit/AppKit.h&gt;</span>
<span class="cp">#import &quot;Controller.h&quot;</span>

<span class="k">@implementation</span> <span class="nc">Controller</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">showCurrentTime:</span><span class="w"> </span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">sender</span>
<span class="p">{</span>
<span class="w">   </span><span class="cm">/* insert your code here */</span>
<span class="w">   </span><span class="n">NSCalendarDate</span><span class="w"> </span><span class="o">*</span><span class="n">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">NSCalendarDate</span><span class="w"> </span><span class="n">date</span><span class="p">];</span>
<span class="w">   </span><span class="p">[</span><span class="n">timeView</span><span class="w"> </span><span class="n">setDate</span><span class="o">:</span><span class="w"> </span><span class="n">date</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">@end</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">main.m:</span></code></p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="cp">#import &lt;AppKit/AppKit.h&gt;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span><span class="w"> </span>
<span class="p">{</span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">NSApplicationMain</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">GNUmakefile:</span></code></p>
<div class="highlight-makefile notranslate"><div class="highlight"><pre><span></span><span class="cp">include $(GNUSTEP_MAKEFILES)/common.make</span>

<span class="nv">APP_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>TimeMachine
<span class="nv">TimeMachine_HEADERS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Controller.h<span class="w"> </span>TimeView.h
<span class="nv">TimeMachine_OBJC_FILES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>main.m<span class="w"> </span>Controller.m<span class="w"> </span>TimeView.m
<span class="nv">TimeMachine_RESOURCE_FILES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>TimeMachineInfo.plist<span class="w"> </span>TimeMachine.gorm
<span class="nv">TimeMachine_MAIN_MODEL_FILE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>TimeMachine.gorm

<span class="cp">include $(GNUSTEP_MAKEFILES)/application.make</span>
</pre></div>
</div>
<p>You should notice that I didn’t instantiate the class “TimeView” in
class “Controller” because when I add an custom view to the window, it
is instantiated automatically. I only need to specify the class the
custom view should be. On the contrary, I have to instantiate the class
“Controller” in Gorm because it is not a GUI component. Without
instantiation, I can’t connect the “controller” to the “view”.</p>
</section>
<hr class="docutils" />
<section id="drawing">
<h2><span id="AEN707">Drawing</span><a class="headerlink" href="#drawing" title="Link to this heading">#</a></h2>
<p>I want a graphic clock, which looks like this:</p>
<p><span id="AEN710"></span></p>
<p><strong>Figure 4-21. Custom view with analog clock</strong></p>
<p><img alt="" src="../../../_images/Drawing-01.jpg" /></p>
<p>It is very simple. I only need to add a new GUI component in the class
TimeView. I call this new class “ClockView”. Since “ClockView” will be
the subview of “TimeView”, when “TimeView” is update, I also need to
update the “ClockView”.</p>
<p><code class="docutils literal notranslate"><span class="pre">ClockView.h:</span></code></p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="cp">#import &lt;AppKit/AppKit.h&gt;</span>
<span class="cp">#include &amp;lt;math.h&gt;</span>

<span class="k">@interface</span> <span class="nc">ClockView</span> : <span class="nc">NSView</span>
<span class="p">{</span>
<span class="w">   </span><span class="n">NSPoint</span><span class="w"> </span><span class="n">posHour</span><span class="p">,</span><span class="w"> </span><span class="n">posMinute</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">setDate:</span><span class="w"> </span><span class="p">(</span><span class="n">NSCalendarDate</span><span class="w"> </span><span class="o">*</span><span class="p">)</span> <span class="nv">aDate</span><span class="p">;</span>
<span class="k">@end</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">ClockView.m:</span></code></p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="cp">#import &quot;ClockView.h&quot;</span>

<span class="k">@implementation</span> <span class="nc">ClockView</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span> <span class="nf">init</span>
<span class="p">{</span>
<span class="w">   </span><span class="nb">self</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nb">super</span><span class="w"> </span><span class="n">init</span><span class="p">];</span>
<span class="w">   </span><span class="n">posHour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NSMakePoint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="w">   </span><span class="n">posMinute</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NSMakePoint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="nb">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">drawRect:</span><span class="w"> </span><span class="p">(</span><span class="n">NSRect</span><span class="p">)</span> <span class="nv">frame</span>
<span class="p">{</span>
<span class="w">   </span><span class="n">NSPoint</span><span class="w"> </span><span class="n">origin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NSMakePoint</span><span class="p">(</span><span class="n">frame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">frame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>

<span class="w">   </span><span class="n">NSBezierPath</span><span class="w"> </span><span class="o">*</span><span class="n">bp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">NSBezierPath</span><span class="w"> </span><span class="n">bezierPathWithRect</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="nb">self</span><span class="w"> </span><span class="n">bounds</span><span class="p">]];</span>
<span class="w">   </span><span class="p">[[</span><span class="n">NSColor</span><span class="w"> </span><span class="n">yellowColor</span><span class="p">]</span><span class="w"> </span><span class="n">set</span><span class="p">];</span>
<span class="w">   </span><span class="p">[</span><span class="n">BP</span><span class="w"> </span><span class="n">fill</span><span class="p">];</span>

<span class="w">   </span><span class="n">BP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">NSBezierPath</span><span class="w"> </span><span class="n">bezierPathWithRect</span><span class="o">:</span><span class="w"> </span><span class="n">NSMakeRect</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">                                                     </span><span class="n">frame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="mi">-2</span><span class="p">,</span>
<span class="w">                                                     </span><span class="n">frame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="mi">-2</span><span class="p">)];</span>
<span class="w">   </span><span class="p">[[</span><span class="n">NSColor</span><span class="w"> </span><span class="n">blackColor</span><span class="p">]</span><span class="w"> </span><span class="n">set</span><span class="p">];</span>
<span class="w">   </span><span class="p">[</span><span class="n">BP</span><span class="w"> </span><span class="n">stroke</span><span class="p">];</span>

<span class="w">   </span><span class="n">BP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">NSBezierPath</span><span class="w"> </span><span class="n">bezierPath</span><span class="p">];</span>
<span class="w">   </span><span class="p">[</span><span class="n">BP</span><span class="w"> </span><span class="n">setLineWidth</span><span class="o">:</span><span class="w"> </span><span class="mi">3</span><span class="p">];</span>
<span class="w">   </span><span class="p">[</span><span class="n">BP</span><span class="w"> </span><span class="n">moveToPoint</span><span class="o">:</span><span class="w"> </span><span class="n">origin</span><span class="p">];</span>
<span class="w">   </span><span class="p">[</span><span class="n">BP</span><span class="w"> </span><span class="n">relativeLineToPoint</span><span class="o">:</span><span class="w"> </span><span class="n">posHour</span><span class="p">];</span>
<span class="w">   </span><span class="p">[</span><span class="n">BP</span><span class="w"> </span><span class="n">stroke</span><span class="p">];</span>

<span class="w">   </span><span class="p">[</span><span class="n">BP</span><span class="w"> </span><span class="n">setLineWidth</span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<span class="w">   </span><span class="p">[</span><span class="n">BP</span><span class="w"> </span><span class="n">moveToPoint</span><span class="o">:</span><span class="w"> </span><span class="n">origin</span><span class="p">];</span>
<span class="w">   </span><span class="p">[</span><span class="n">BP</span><span class="w"> </span><span class="n">relativeLineToPoint</span><span class="o">:</span><span class="w"> </span><span class="n">posMinute</span><span class="p">];</span>
<span class="w">   </span><span class="p">[</span><span class="n">BP</span><span class="w"> </span><span class="n">stroke</span><span class="p">];</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">setDate:</span><span class="w"> </span><span class="p">(</span><span class="n">NSCalendarDate</span><span class="w"> </span><span class="o">*</span><span class="p">)</span> <span class="nv">date</span><span class="p">;</span>
<span class="p">{</span>
<span class="w">   </span><span class="kt">int</span><span class="w"> </span><span class="n">hour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">date</span><span class="w"> </span><span class="n">hourOfDay</span><span class="p">];</span>
<span class="w">   </span><span class="kt">int</span><span class="w"> </span><span class="n">minute</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">date</span><span class="w"> </span><span class="n">minuteOfHour</span><span class="p">];</span>
<span class="w">   </span><span class="kt">float</span><span class="w"> </span><span class="n">hour_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">40</span><span class="o">*</span><span class="n">sin</span><span class="p">((</span><span class="n">M_PI</span><span class="o">*</span><span class="n">hour</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">M_PI</span><span class="o">*</span><span class="n">minute</span><span class="o">/</span><span class="mi">360</span><span class="p">));</span>
<span class="w">   </span><span class="kt">float</span><span class="w"> </span><span class="n">hour_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">40</span><span class="o">*</span><span class="n">cos</span><span class="p">((</span><span class="n">M_PI</span><span class="o">*</span><span class="n">hour</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">M_PI</span><span class="o">*</span><span class="n">minute</span><span class="o">/</span><span class="mi">360</span><span class="p">));</span>
<span class="w">   </span><span class="kt">float</span><span class="w"> </span><span class="n">minute_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">60</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">M_PI</span><span class="o">*</span><span class="n">minute</span><span class="o">/</span><span class="mi">30</span><span class="p">);</span>
<span class="w">   </span><span class="kt">float</span><span class="w"> </span><span class="n">minute_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">60</span><span class="o">*</span><span class="n">COs</span><span class="p">(</span><span class="n">M_PI</span><span class="o">*</span><span class="n">minute</span><span class="o">/</span><span class="mi">30</span><span class="p">);</span>

<span class="w">   </span><span class="n">posHour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NSMakePoint</span><span class="p">(</span><span class="n">hour_x</span><span class="p">,</span><span class="w"> </span><span class="n">hour_y</span><span class="p">);</span>
<span class="w">   </span><span class="n">posMinute</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NSMakePoint</span><span class="p">(</span><span class="n">minute_x</span><span class="p">,</span><span class="w"> </span><span class="n">minute_y</span><span class="p">);</span>
<span class="w">   </span><span class="p">[</span><span class="nb">self</span><span class="w"> </span><span class="n">setNeedsDisplay</span><span class="o">:</span><span class="w"> </span><span class="nb">YES</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">@end</span>
</pre></div>
</div>
<p>ClockView inherits from NSView. The most important method it should
override is -drawRect:. When this view need to update, -drawRect: will
be called. Therefore, I put all the drawing in this method. NSBezierPath
is how GNUstep draws. I assign the path, set the color, then draw. There
are good article about drawing: <a class="reference external" href="http://www.macdevcenter.com/pub/a/mac/2001/10/19/cocoa.html"><em>Introduction to Cocoa Graphics, Part
I</em></a>, <a class="reference external" href="http://www.macdevcenter.com/pub/a/mac/2001/11/06/cocoa.html"><em>Part
II</em></a>.</p>
<p>A few codes are needed to include ClockView in TimeView. One is to add
ClockView as a subview of NSBox in TimeView. Another is to update
ClockView when TimeView is update. In method -setDate: of ClockView, it
uses [self setNeedsDisplay: YES] to make this view update. This
modification is easy to do. You can play around it.</p>
</section>
<hr class="docutils" />
<section id="panel">
<h2><span id="AEN728">Panel</span><a class="headerlink" href="#panel" title="Link to this heading">#</a></h2>
<p>Panel is a special kind of window. Read the Cocoa document for more
details: <a class="reference external" href="http://developer.apple.com/techpubs/macosx/Cocoa/TasksAndConcepts/ProgrammingTopics/WinPanel/index.html"><em>Windows and
Panels</em></a>.
Since I have a clock already, I want to know the time in different time
zones. My idea is that when I click the title of the NSBox, a panel will
show up and ask the time zone. Once the time zone is inputted, it will
display the time in that area. Since NSPanel is a subclass of NSWindow,
the usage of NSPanel is similar to the NSWindow. Again, I need a
“controller” to control the “view”, which is NSPanel in this case.
“View” is generated by Gorm, and I need to write the “controller” by
myself. In this example, I’ll show how to load the gorm file. There are
many built-in panel in GNUstep. I also use one in this example.</p>
<p>Firstly, I need to build the interface for the panel. Open Gorm, Choose
menu “Document → New Module → New Empty”. Look at the palettes.
There is one for panel.</p>
<p><span id="AEN734"></span></p>
<p><strong>Figure 4-22. Panel in Gorm</strong></p>
<p><img alt="" src="../../../_images/Panel-01.jpg" /></p>
<p>Drag the panel out of palettes. Build the interface as below.</p>
<p><span id="AEN740"></span></p>
<p><strong>Figure 4-23. Interface of time zone panel</strong></p>
<p><img alt="" src="../../../_images/Panel-02.jpg" /></p>
<p>You can change the size of panel in the inspector. Here is the
attributes of this panel I use.</p>
<p><span id="AEN746"></span></p>
<p><strong>Figure 4-24. Panel attributes</strong></p>
<p><img alt="" src="../../../_images/Panel-03.jpg" /></p>
<p>Now, I got the “view”. Then where is the “controller” ? Generally, I can
write a new class as the controller of this view, but this is a small
program. It is not necessary to write a new class only as the
controller. So I decide to use the class “TimeView” as the controller
for this panel. So class “TimeView” acts as the custom view for that
main window interface, and the controller for the panel. Since
“TimeView” is the controller of this panel, I need to connect the
outlets and actions. Therefore, I need to create the class “TimeView”
again in this gorm file, even though there is already one in
TimeMachine.gorm file.</p>
<p>You already know how to create the class “TimeView”. I add two outlets,
“zonePanel” and “zoneField”, and two actions, “okAction:” and
“cancelAction:”.</p>
<p><span id="AEN753"></span></p>
<p><strong>Figure 4-25. Outlets for time zone panel</strong></p>
<p><img alt="" src="../../../_images/Panel-05.jpg" /></p>
<p><span id="AEN758"></span></p>
<p><strong>Figure 4-26. Actions for time zone panel</strong></p>
<p><img alt="" src="../../../_images/Panel-04.jpg" /></p>
<p>But rather than creating an instance to connect the panel, I’ll set the
owner of this panel as the class “TimeView”. The advantage is that I can
reduce the number of instances to use.</p>
<p>Select the NSOwner in Gorm main window, then select class “TimeView” in
“attributes” of inspector.</p>
<p><span id="AEN765"></span></p>
<p><strong>Figure 4-27. Set NSOwner to TimeView class</strong></p>
<p><img alt="" src="../../../_images/Panel-06.jpg" /></p>
<p><img alt="" src="../../../_images/Panel-07.jpg" /></p>
<p>By this way, I can connect the panel to the NSOwner, which is an
instance of class “TimeView”. Connect the two buttons to the actions in
NSOwner, the outlet “zoneField” to the NSTextField in panel, and the
outlet “zonePanel” to the panel. Pay attention to how the NSOwner
connects to the panel.</p>
<p><span id="AEN774"></span></p>
<p><strong>Figure 4-28. Connect outlet</strong></p>
<p><img alt="" src="../../../_images/Panel-08.jpg" /></p>
<p><img alt="" src="../../../_images/Panel-09.jpg" /></p>
<p>Save this interface as “TimeZonePanel.gorm” file, and quit Gorm. Don’t
generate the files for class “TimeView” because I already have the
files. GNUstep can figure out where the classes are and where the
outlets/actions are.</p>
<p>Now, I need to add the new outlets and actions into the files of
“TimeView”. Here is the header.</p>
<p><code class="docutils literal notranslate"><span class="pre">TimeView.h:</span></code></p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="cp">#import &lt;AppKit/AppKit.h&gt;</span>
<span class="cp">#import &quot;ClockView.h&quot;</span>

<span class="k">@interface</span> <span class="nc">TimeView</span> : <span class="nc">NSControl</span>
<span class="p">{</span>
<span class="w">   </span><span class="kt">id</span><span class="w"> </span><span class="n">zonePanel</span><span class="p">;</span>
<span class="w">   </span><span class="kt">id</span><span class="w"> </span><span class="n">zoneField</span><span class="p">;</span>
<span class="w">   </span><span class="n">NSBox</span><span class="w"> </span><span class="o">*</span><span class="n">box</span><span class="p">;</span>
<span class="w">   </span><span class="n">NSTextField</span><span class="w"> </span><span class="o">*</span><span class="n">labelDate</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">labelTime</span><span class="p">;</span>
<span class="w">   </span><span class="n">NSTextField</span><span class="w"> </span><span class="o">*</span><span class="n">localDate</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">localTime</span><span class="p">;</span>
<span class="w">   </span><span class="n">NSCalendarDate</span><span class="w"> </span><span class="o">*</span><span class="n">date</span><span class="p">;</span>
<span class="w">   </span><span class="n">ClockView</span><span class="w"> </span><span class="o">*</span><span class="n">clockView</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="n">NSCalendarDate</span><span class="w"> </span><span class="o">*</span><span class="p">)</span> <span class="nf">date</span><span class="p">;</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">setDate:</span><span class="w"> </span><span class="p">(</span><span class="n">NSCalendarDate</span><span class="w"> </span><span class="o">*</span><span class="p">)</span> <span class="nv">date</span><span class="p">;</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">okAction:</span><span class="w"> </span><span class="p">(</span><span class="kt">id</span><span class="p">)</span> <span class="nv">sender</span><span class="p">;</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">cancelAction:</span><span class="w"> </span><span class="p">(</span><span class="kt">id</span><span class="p">)</span> <span class="nv">sender</span><span class="p">;</span>
<span class="k">@end</span>
</pre></div>
</div>
<p>I add the outlets and actions by myself.</p>
<p><code class="docutils literal notranslate"><span class="pre">TimeView.m:</span></code></p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">mouseDown:</span><span class="w"> </span><span class="p">(</span><span class="bp">NSEvent</span><span class="w"> </span><span class="o">*</span><span class="p">)</span> <span class="nv">event</span>
<span class="p">{</span>
<span class="w">   </span><span class="n">NSRect</span><span class="w"> </span><span class="n">titleFrame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">box</span><span class="w"> </span><span class="n">titleRect</span><span class="p">];</span>
<span class="w">   </span><span class="n">NSPoint</span><span class="w"> </span><span class="n">windowLocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">event</span><span class="w"> </span><span class="n">locationInWindow</span><span class="p">];</span>
<span class="w">   </span><span class="n">NSPoint</span><span class="w"> </span><span class="n">viewLocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nb">self</span><span class="w"> </span><span class="n">convertPoint</span><span class="o">:</span><span class="w"> </span><span class="n">windowLocation</span><span class="w"> </span><span class="n">fromView</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="nb">self</span><span class="w"> </span><span class="n">superview</span><span class="p">]];</span>
<span class="w">   </span><span class="kt">BOOL</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NSMouseInRect</span><span class="p">(</span><span class="n">viewLocation</span><span class="p">,</span><span class="w"> </span><span class="n">titleFrame</span><span class="p">,</span><span class="w"> </span><span class="nb">NO</span><span class="p">);</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">YES</span><span class="p">)</span>
<span class="w">     </span><span class="p">{</span>
<span class="w">       </span><span class="p">[</span><span class="bp">NSBundle</span><span class="w"> </span><span class="n">loadNibNamed</span><span class="o">:</span><span class="w"> </span><span class="s">@&quot;TimeZonePanel.gorm&quot;</span><span class="w"> </span><span class="n">owner</span><span class="o">:</span><span class="w"> </span><span class="nb">self</span><span class="p">];</span><span class="w"> </span>
<span class="w">       </span><span class="p">[</span><span class="n">NSApp</span><span class="w"> </span><span class="n">runModalForWindow</span><span class="o">:</span><span class="w"> </span><span class="n">zonePanel</span><span class="p">];</span>
<span class="w">     </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The method -mouseDown: is called when mouse is clicked within this view.
Here, I calculate whether the mouse is clicked in the area of the title
of NSBox. If so, use [NSBundle loadNibName: owner:] to load the
window, and [NSApp runModalForWindow] display it. Read Cocoa’s
document about “<a class="reference external" href="http://developer.apple.com/techpubs/macosx/Cocoa/TasksAndConcepts/ProgrammingTopics/WinPanel/Concepts/UsingModalWindows.html#CJBEADBA"><em>How Modal Windows
Work</em></a>”.</p>
<p>Now, I just need to finish the actions part in <code class="docutils literal notranslate"><span class="pre">TimeView.m</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">TimeView.m:</span></code></p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">cancelAction:</span><span class="w"> </span><span class="p">(</span><span class="kt">id</span><span class="p">)</span> <span class="nv">sender</span>
<span class="p">{</span>
<span class="w">   </span><span class="p">[</span><span class="n">NSApp</span><span class="w"> </span><span class="n">abortModal</span><span class="p">];</span>
<span class="w">   </span><span class="p">[</span><span class="n">zonePanel</span><span class="w"> </span><span class="n">close</span><span class="p">];</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">okAction:</span><span class="w"> </span><span class="p">(</span><span class="kt">id</span><span class="p">)</span> <span class="nv">sender</span>
<span class="p">{</span>
<span class="w">   </span><span class="bp">NSTimeZone</span><span class="w"> </span><span class="o">*</span><span class="n">tempZone</span><span class="p">;</span>
<span class="w">   </span><span class="n">tempZone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="bp">NSTimeZone</span><span class="w"> </span><span class="n">timeZoneWithName</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="n">zoneField</span><span class="w"> </span><span class="n">stringValue</span><span class="p">]];</span>
<span class="w">   </span><span class="p">[</span><span class="n">NSApp</span><span class="w"> </span><span class="n">stopModal</span><span class="p">];</span>
<span class="w">   </span><span class="p">[</span><span class="n">zonePanel</span><span class="w"> </span><span class="n">close</span><span class="p">];</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tempZone</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">nil</span><span class="p">)</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">         </span><span class="n">NSRunAlertPanel</span><span class="p">(</span><span class="s">@&quot;Warning!&quot;</span><span class="p">,</span>
<span class="w">                         </span><span class="s">@&quot;Wrong Time Zone !!&quot;</span><span class="p">,</span>
<span class="w">                         </span><span class="s">@&quot;OK&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">nil</span><span class="p">,</span><span class="w"> </span><span class="nb">nil</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">   </span><span class="k">else</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">         </span><span class="p">[</span><span class="n">date</span><span class="w"> </span><span class="n">setTimeZone</span><span class="o">:</span><span class="w"> </span><span class="n">tempZone</span><span class="p">];</span>
<span class="w">         </span><span class="p">[</span><span class="n">box</span><span class="w"> </span><span class="n">setTitle</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="n">tempZone</span><span class="w"> </span><span class="n">description</span><span class="p">]];</span>
<span class="w">         </span><span class="p">[</span><span class="nb">self</span><span class="w"> </span><span class="n">setDate</span><span class="o">:</span><span class="w"> </span><span class="n">date</span><span class="p">];</span>
<span class="w">      </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In method -okAction:, I use a built-in panel, NSRunAlertPanel. There are
several built-in panels in GNUstep ready to use. Now, you can display
the current time in different time zone.</p>
<p>It is inconvenient to use this pop-up panel because you have to click
the NSTextField before typing. Sometimes, it is more convenient to
control the user interface via keyboard rather than mouse. Here, I touch
a little bit this topic to make the panel more easy to use.</p>
<p>When a window pop-up, it is the first object to receive events and
key-in. It is called the “First Responder”. But usually we want some
other objects in this window to receive the key-in. Therefore, we need
to change the “first responder” of this window, which I can do that by
using [NSWindow makeFirstResonpder:].</p>
<p>When I want to use “Tab” key to switch between different views in the
window, I need to assign the “nextKeyView” for the next view when “Tab”
key is pressed so that the application know where the responder should
be.</p>
<p>Finally, when I finish typing in the NSTextField, I want to hit the
“Return” key equivalent to press the “OK” button by mouse so that I
don’t need to move my hand out of the keyboard. In this case, since
NSTextField is also a subclass of NSControl, I can set the target and
action of NSTextField the same as the NSButton “OK”. Therefore, when I
hit the “Return”, it is equivalent to click on the “OK” button.</p>
<p>These are small tune-ups for the application, but it makes users more
easy to use the application.</p>
<p>Firstly, let’s set the “first responder” of the window to the
NSTextField:</p>
<p><code class="docutils literal notranslate"><span class="pre">TimeView.m:</span></code></p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">mouseDown:</span><span class="w"> </span><span class="p">(</span><span class="bp">NSEvent</span><span class="w"> </span><span class="o">*</span><span class="p">)</span> <span class="nv">event</span>
<span class="p">{</span>
<span class="w">   </span><span class="n">NSRect</span><span class="w"> </span><span class="n">titleFrame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">box</span><span class="w"> </span><span class="n">titleRect</span><span class="p">];</span>
<span class="w">   </span><span class="n">NSPoint</span><span class="w"> </span><span class="n">windowLocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">event</span><span class="w"> </span><span class="n">locationInWindow</span><span class="p">];</span>
<span class="w">   </span><span class="n">NSPoint</span><span class="w"> </span><span class="n">viewLocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nb">self</span><span class="w"> </span><span class="n">convertPoint</span><span class="o">:</span><span class="w"> </span><span class="n">windowLocation</span><span class="w"> </span><span class="n">fromView</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="nb">self</span><span class="w"> </span><span class="n">superview</span><span class="p">]];</span>
<span class="w">   </span><span class="kt">BOOL</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NSMouseInRect</span><span class="p">(</span><span class="n">viewLocation</span><span class="p">,</span><span class="w"> </span><span class="n">titleFrame</span><span class="p">,</span><span class="w"> </span><span class="nb">NO</span><span class="p">);</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">YES</span><span class="p">)</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">         </span><span class="p">[</span><span class="bp">NSBundle</span><span class="w"> </span><span class="n">loadNibNamed</span><span class="o">:</span><span class="w"> </span><span class="s">@&quot;TimeZonePanel.gorm&quot;</span><span class="w"> </span><span class="n">owner</span><span class="o">:</span><span class="w"> </span><span class="nb">self</span><span class="p">];</span><span class="w"> </span>
<span class="w">         </span><span class="p">[</span><span class="n">zonePanel</span><span class="w"> </span><span class="n">makeFirstResponder</span><span class="o">:</span><span class="w"> </span><span class="n">zoneField</span><span class="p">];</span>
<span class="w">         </span><span class="p">[</span><span class="n">NSApp</span><span class="w"> </span><span class="n">runModalForWindow</span><span class="o">:</span><span class="w"> </span><span class="n">zonePanel</span><span class="p">];</span>
<span class="w">      </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Only one line is enough. Now, when this panel shows up, the cursor will
automatically in the NSTextField, and this NSTextField are ready to
type.</p>
<p>Secondly, I want to set the target and action of NSTextField the same as
the NSButton “O.K.”. Open the TimeZonePanel.gorm, connect the
NSTextField to the method -okAction: of the NSOwner. That’s it. Whenever
you hit the “Return” key in the NSTextField, the method -okAction: is
called.</p>
<p><span id="AEN814"></span></p>
<p><strong>Figure 4-29. Connection NSTextField action</strong></p>
<p><img alt="" src="../../../_images/Panel-10.jpg" /></p>
<p><img alt="" src="../../../_images/Panel-11.jpg" /></p>
<p><img alt="" src="../../../_images/Panel-12.jpg" /></p>
<p>Thirdly, I need to connect the nextKeyView outlet between the views in
the window. I’ll connect the nextKeyView of NSTextField to NSButton
“O.K.”, the nextKeyView outlet of NSButton “O.K.” to NSButton “Cancel”,
and the nextKeyView outlet of NSButton “Cancel” to the NSTextField. By
doing that, I can switch between these views by “Tab” key. Here, I just
show how the nextKeyView of NSTextField connects to NSButton “O.K.”. You
can do the rest of the part.</p>
<p><span id="AEN826"></span></p>
<p><strong>Figure 4-30. Connect nextKeyView</strong></p>
<p><img alt="" src="../../../_images/Panel-13.jpg" /></p>
<p><img alt="" src="../../../_images/Panel-14.jpg" /></p>
<p>Source code:
<a class="reference external" href="http://gnustep.made-it.com/GSPT/Panel/Panel-src.tar.gz">Panel-src.tar.gz</a>.</p>
</section>
<hr class="docutils" />
<section id="notification">
<h2><span id="AEN836">Notification</span><a class="headerlink" href="#notification" title="Link to this heading">#</a></h2>
<p>Since I can change the time zone, I would like to display several clock
at the same window, and adjust the number of clocks dynamically. First,
I need to add new submenu: “Edit”, and two menu item in it: “Add Clock”
and “Delete Clock”. Then add two action in the class “Controller”:
“addClock:” and “deleteClock”. Connect the menu item to the action in
the instance of class “Controller” in the gorm file. Then I have done
the part of interface. When user select the menu item “Add Clock”, the
method “addClock:” will be called, so does the menu item “Delete Clock”.</p>
<p>Now, how do I manage these clocks dynamically ? I can trace each of them
manually, but it will be complicated. Another way is that I don’t trace
any of them, but the problem is how do it control any of them ? I can
use the notification in GNUstep, which is a pretty handy way to
communicate between objects.</p>
<p>Here is a related article:
<a class="reference external" href="http://cocoadevcentral.com/articles/000029.php"><em>NSNotificationCenter</em></a></p>
<p>Firstly, I need to adjust the interface according to the adding and
deleting clock. I need trace how many clocks exist so that I won’t
accidentally delete the last clock.</p>
<p><code class="docutils literal notranslate"><span class="pre">Controller.h:</span></code></p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="cp">#import &lt;AppKit/AppKit.h&gt;</span>
<span class="cp">#import &quot;TimeView.h&quot;</span>

<span class="k">@interface</span> <span class="nc">Controller</span> : <span class="bp">NSObject</span>
<span class="p">{</span>
<span class="w">   </span><span class="kt">id</span><span class="w"> </span><span class="n">timeView</span><span class="p">;</span>
<span class="w">   </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">totalNumber</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">showCurrentTime:</span><span class="w"> </span><span class="p">(</span><span class="kt">id</span><span class="p">)</span> <span class="nv">sender</span><span class="p">;</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">addClock:</span><span class="w"> </span><span class="p">(</span><span class="kt">id</span><span class="p">)</span> <span class="nv">sender</span><span class="p">;</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">deleteClock:</span><span class="w"> </span><span class="p">(</span><span class="kt">id</span><span class="p">)</span> <span class="nv">sender</span><span class="p">;</span>
<span class="k">@end</span>
</pre></div>
</div>
<p>I add a variable, totalNumber to trace the number of clocks, and add two
actions manually since I didn’t generate the class files from Gorm.</p>
<p><code class="docutils literal notranslate"><span class="pre">Controller.m:</span></code></p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span> <span class="nf">init</span>
<span class="p">{</span>
<span class="w">   </span><span class="nb">self</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nb">super</span><span class="w"> </span><span class="n">init</span><span class="p">];</span>
<span class="w">   </span><span class="n">totalNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="nb">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">addClock:</span><span class="w"> </span><span class="p">(</span><span class="kt">id</span><span class="p">)</span> <span class="nv">sender</span>
<span class="p">{</span>
<span class="w">   </span><span class="n">TimeView</span><span class="w"> </span><span class="o">*</span><span class="n">aView</span><span class="p">;</span>
<span class="w">   </span><span class="n">NSWindow</span><span class="w"> </span><span class="o">*</span><span class="n">mainWindow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">NSApp</span><span class="w"> </span><span class="n">mainWindow</span><span class="p">];</span>
<span class="w">   </span><span class="n">NSRect</span><span class="w"> </span><span class="n">windowFrame</span><span class="p">,</span><span class="w"> </span><span class="n">timeViewFrame</span><span class="p">;</span>
<span class="w">   </span><span class="n">windowFrame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">mainWindow</span><span class="w"> </span><span class="n">frame</span><span class="p">];</span>
<span class="w">   </span><span class="n">timeViewFrame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">timeView</span><span class="w"> </span><span class="n">frame</span><span class="p">];</span>

<span class="w">   </span><span class="p">[</span><span class="n">mainWindow</span><span class="w"> </span><span class="n">setFrame</span><span class="o">:</span><span class="w"> </span><span class="n">NSMakeRect</span><span class="p">(</span><span class="n">windowFrame</span><span class="p">.</span><span class="n">origin</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w">    </span>
<span class="w">                                    </span><span class="n">windowFrame</span><span class="p">.</span><span class="n">origin</span><span class="p">.</span><span class="n">y</span><span class="p">,</span>
<span class="w">                                    </span><span class="n">windowFrame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="o">+</span><span class="n">timeViewFrame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">,</span><span class="w"> </span>
<span class="w">                                    </span><span class="n">windowFrame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">)</span>
<span class="w">                </span><span class="nl">display</span><span class="p">:</span><span class="w"> </span><span class="nb">YES</span><span class="p">];</span>
<span class="w">   </span><span class="n">aView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[</span><span class="n">TimeView</span><span class="w"> </span><span class="n">alloc</span><span class="p">]</span><span class="w"> </span><span class="n">initWithFrame</span><span class="o">:</span><span class="w"> </span><span class="n">NSMakeRect</span><span class="p">(</span><span class="n">timeViewFrame</span><span class="p">.</span><span class="n">origin</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">totalNumber</span><span class="o">*</span><span class="n">timeViewFrame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">,</span>
<span class="w">                                                       </span><span class="n">timeViewFrame</span><span class="p">.</span><span class="n">origin</span><span class="p">.</span><span class="n">y</span><span class="p">,</span>
<span class="w">                                                       </span><span class="n">timeViewFrame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">,</span>
<span class="w">                                                       </span><span class="n">timeViewFrame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">)];</span>
<span class="w">   </span>
<span class="w">   </span><span class="p">[[</span><span class="n">mainWindow</span><span class="w"> </span><span class="n">contentView</span><span class="p">]</span><span class="w"> </span><span class="n">addSubview</span><span class="o">:</span><span class="w"> </span><span class="n">aView</span><span class="p">];</span>
<span class="w">   </span><span class="n">RELEASE</span><span class="p">(</span><span class="n">aView</span><span class="p">);</span>
<span class="w">   </span><span class="n">totalNumber</span><span class="w"> </span><span class="o">++</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">deleteClock:</span><span class="w"> </span><span class="p">(</span><span class="kt">id</span><span class="p">)</span> <span class="nv">sender</span>
<span class="p">{</span>
<span class="w">   </span><span class="bp">NSArray</span><span class="w"> </span><span class="o">*</span><span class="n">subviews</span><span class="p">;</span>
<span class="w">   </span><span class="n">NSWindow</span><span class="w"> </span><span class="o">*</span><span class="n">mainWindow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">NSApp</span><span class="w"> </span><span class="n">mainWindow</span><span class="p">];</span>
<span class="w">   </span><span class="n">NSRect</span><span class="w"> </span><span class="n">windowFrame</span><span class="p">,</span><span class="w"> </span><span class="n">timeViewFrame</span><span class="p">;</span>
<span class="w">   </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">   </span><span class="n">windowFrame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">mainWindow</span><span class="w"> </span><span class="n">frame</span><span class="p">];</span>
<span class="w">   </span><span class="n">timeViewFrame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">timeView</span><span class="w"> </span><span class="n">frame</span><span class="p">];</span>

<span class="w">   </span><span class="n">subviews</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[</span><span class="n">mainWindow</span><span class="w"> </span><span class="n">contentView</span><span class="p">]</span><span class="w"> </span><span class="n">subviews</span><span class="p">];</span>

<span class="w">   </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">subviews</span><span class="w"> </span><span class="n">count</span><span class="p">]</span><span class="mi">-1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">--</span><span class="p">)</span><span class="w"> </span>
<span class="w">     </span><span class="p">{</span>
<span class="w">       </span><span class="k">if</span><span class="w"> </span><span class="p">([[</span><span class="n">subviews</span><span class="w"> </span><span class="n">objectAtIndex</span><span class="o">:</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="n">isMemberOfClass</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="n">TimeView</span><span class="w"> </span><span class="k">class</span><span class="p">]])</span><span class="w">  </span>
<span class="w">       </span><span class="p">[[</span><span class="n">subviews</span><span class="w"> </span><span class="n">objectAtIndex</span><span class="o">:</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="n">removeFromSuperview</span><span class="p">];</span>
<span class="w">       </span><span class="n">totalNumber</span><span class="o">--</span><span class="p">;</span>
<span class="w">       </span><span class="p">[</span><span class="n">mainWindow</span><span class="w"> </span><span class="n">setFrame</span><span class="o">:</span><span class="w"> </span><span class="n">NSMakeRect</span><span class="p">(</span><span class="n">windowFrame</span><span class="p">.</span><span class="n">origin</span><span class="p">.</span><span class="n">x</span><span class="p">,</span>
<span class="w">                                        </span><span class="n">windowFrame</span><span class="p">.</span><span class="n">origin</span><span class="p">.</span><span class="n">y</span><span class="p">,</span>
<span class="w">                                        </span><span class="n">windowFrame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="o">-</span><span class="n">timeViewFrame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">,</span>
<span class="w">                                        </span><span class="n">windowFrame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">)</span>
<span class="w">                    </span><span class="nl">display</span><span class="p">:</span><span class="w"> </span><span class="nb">YES</span><span class="p">];</span>
<span class="w">       </span><span class="k">break</span><span class="p">;</span>
<span class="w">     </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In the method -init, I initiate the variable, totalNumber, as 1 since
there is already one in the Gorm file. In method -addClock:, I have to
calculate the change of window size and where to put the new clock. They
are done by very simple calculation. Once I add the new clock into the
window, the window will retain this clock. Therefore, I can release it
and no longer trace it. In the method -deleteClock:, I also need to
change the size of window by simple calculation. The only problem is
that since I don’t trace the clocks, how do I delete them ? I can get
all the subviews from the window, and delete from the last “TimeView”
object. That’s the way I can access the objects in the window. Very easy
to maintain.</p>
<p>Now, if you hit the button “Get Current Time”, you will notice that only
the origin clock is updated. That’s because it is the only one which is
connected by the outlet. I can get all the subviews from the window, and
call their method one by one. That will work, but is not a elegent way.
I can use the “Notification” and “Notification Center” to archive this
goal. Read the <a class="reference external" href="http://developer.apple.com/techpubs/macosx/Cocoa/TasksAndConcepts/ProgrammingTopics/Notifications/index.html"><em>Cocoa
document</em></a>
for more details.</p>
<p>The idea is that an object can be a speaker, and many objects can be the
audience. So one talks, many listen. That’s the way it works. So when
user press the button “Get Current Time”, the “Controller” must speak to
all the clocks. Below is how it speak:</p>
<p><code class="docutils literal notranslate"><span class="pre">Controller.h:</span></code></p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">showCurrentTime:</span><span class="w"> </span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">sender</span>
<span class="p">{</span>
<span class="w">   </span><span class="p">[[</span><span class="bp">NSNotificationCenter</span><span class="w"> </span><span class="n">defaultCenter</span><span class="p">]</span><span class="w"> </span><span class="n">postNotificationName</span><span class="o">:</span><span class="w"> </span><span class="s">@&quot;TimeViewShouldUpdateCurrentTime&quot;</span>
<span class="w">                                                       </span><span class="nl">object</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="n">NSCalendarDate</span><span class="w"> </span><span class="n">date</span><span class="p">]];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Actually, it talks to the “Notification Center”, and the notification
center will broadcast what it say. I need to specify the name of
notification because there are so many notifications on the air. The
name of notification is the way to distinguish them. And a notification
can contain an object within it. That’s how the speaker and audience
transfer the information. It can be nil. Here, I use [NSCalendarDate
date].</p>
<p>Now, the speaker speaks. How do the audience listen ? In this example,
all the instance of class TimeView should listen in order to update the
current time. I need to register the audience to the notification center
so that they can receive the notification.</p>
<p><code class="docutils literal notranslate"><span class="pre">TimeView.m:</span></code></p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span> <span class="nf">initWithFrame:</span><span class="w"> </span><span class="p">(</span><span class="n">NSRect</span><span class="p">)</span> <span class="nv">frame</span>
<span class="p">{</span>
<span class="w">   </span><span class="nb">self</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nb">super</span><span class="w"> </span><span class="n">initWithFrame</span><span class="o">:</span><span class="w"> </span><span class="n">frame</span><span class="p">];</span>

<span class="w">   </span><span class="n">box</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[</span><span class="n">NSBox</span><span class="w"> </span><span class="n">alloc</span><span class="p">]</span><span class="w"> </span><span class="n">initWithFrame</span><span class="o">:</span><span class="w"> </span><span class="n">NSMakeRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">                                                  </span><span class="n">frame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">,</span>
<span class="w">                                                  </span><span class="n">frame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">)];</span>
<span class="w">   </span><span class="p">[</span><span class="n">box</span><span class="w"> </span><span class="n">setBorderType</span><span class="o">:</span><span class="w"> </span><span class="n">NSGrooveBorder</span><span class="p">];</span>
<span class="w">   </span><span class="p">[</span><span class="n">box</span><span class="w"> </span><span class="n">setTitlePosition</span><span class="o">:</span><span class="w"> </span><span class="n">NSAtTop</span><span class="p">];</span>
<span class="w">   </span><span class="p">[</span><span class="n">box</span><span class="w"> </span><span class="n">setTitle</span><span class="o">:</span><span class="w"> </span><span class="s">@&quot;Local Time&quot;</span><span class="p">];</span>

<span class="w">   </span><span class="n">clockView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[</span><span class="n">ClockView</span><span class="w"> </span><span class="n">alloc</span><span class="p">]</span><span class="w"> </span><span class="n">initWithFrame</span><span class="o">:</span><span class="w"> </span><span class="n">NSMakeRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">70</span><span class="p">,</span><span class="w"> </span>
<span class="w">                                                            </span><span class="n">frame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">,</span>
<span class="w">                                                            </span><span class="n">frame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">)];</span>
<span class="w">   </span><span class="n">labelDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[</span><span class="n">NSTextField</span><span class="w"> </span><span class="n">alloc</span><span class="p">]</span><span class="w"> </span><span class="n">initWithFrame</span><span class="o">:</span><span class="w"> </span><span class="n">NSMakeRect</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">45</span><span class="p">,</span><span class="w"> </span><span class="mi">35</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">)];</span>
<span class="w">   </span><span class="p">[</span><span class="n">labelDate</span><span class="w"> </span><span class="n">setStringValue</span><span class="o">:</span><span class="w"> </span><span class="s">@&quot;Date: &quot;</span><span class="p">];</span>
<span class="w">   </span><span class="p">[</span><span class="n">labelDate</span><span class="w"> </span><span class="n">setBezeled</span><span class="o">:</span><span class="w"> </span><span class="nb">NO</span><span class="p">];</span>
<span class="w">   </span><span class="p">[</span><span class="n">labelDate</span><span class="w"> </span><span class="n">setBackgroundColor</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="n">NSColor</span><span class="w"> </span><span class="n">windowBackgroundColor</span><span class="p">]];</span>
<span class="w">   </span><span class="p">[</span><span class="n">labelDate</span><span class="w"> </span><span class="n">setEditable</span><span class="o">:</span><span class="w"> </span><span class="nb">NO</span><span class="p">];</span>

<span class="w">   </span><span class="n">labelTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[</span><span class="n">NSTextField</span><span class="w"> </span><span class="n">alloc</span><span class="p">]</span><span class="w"> </span><span class="n">initWithFrame</span><span class="o">:</span><span class="w"> </span><span class="n">NSMakeRect</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">35</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">)];</span>
<span class="w">   </span><span class="p">[</span><span class="n">labelTime</span><span class="w"> </span><span class="n">setStringValue</span><span class="o">:</span><span class="w"> </span><span class="s">@&quot;Time: &quot;</span><span class="p">];</span>
<span class="w">   </span><span class="p">[</span><span class="n">labelTime</span><span class="w"> </span><span class="n">setBezeled</span><span class="o">:</span><span class="w"> </span><span class="nb">NO</span><span class="p">];</span>
<span class="w">   </span><span class="p">[</span><span class="n">labelTime</span><span class="w"> </span><span class="n">setBackgroundColor</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="n">NSColor</span><span class="w"> </span><span class="n">windowBackgroundColor</span><span class="p">]];</span>
<span class="w">   </span><span class="p">[</span><span class="n">labelTime</span><span class="w"> </span><span class="n">setEditable</span><span class="o">:</span><span class="w"> </span><span class="nb">NO</span><span class="p">];</span>

<span class="w">   </span><span class="n">localDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[</span><span class="n">NSTextField</span><span class="w"> </span><span class="n">alloc</span><span class="p">]</span><span class="w"> </span><span class="n">initWithFrame</span><span class="o">:</span><span class="w"> </span><span class="n">NSMakeRect</span><span class="p">(</span><span class="mi">55</span><span class="p">,</span><span class="w"> </span><span class="mi">45</span><span class="p">,</span><span class="w"> </span><span class="mi">130</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">)];</span>
<span class="w">   </span><span class="n">localTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[</span><span class="n">NSTextField</span><span class="w"> </span><span class="n">alloc</span><span class="p">]</span><span class="w"> </span><span class="n">initWithFrame</span><span class="o">:</span><span class="w"> </span><span class="n">NSMakeRect</span><span class="p">(</span><span class="mi">55</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">130</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">)];</span>

<span class="w">   </span><span class="p">[</span><span class="n">box</span><span class="w"> </span><span class="n">addSubview</span><span class="o">:</span><span class="w"> </span><span class="n">clockView</span><span class="p">];</span>
<span class="w">   </span><span class="p">[</span><span class="n">box</span><span class="w"> </span><span class="n">addSubview</span><span class="o">:</span><span class="w"> </span><span class="n">labelDate</span><span class="p">];</span>
<span class="w">   </span><span class="p">[</span><span class="n">box</span><span class="w"> </span><span class="n">addSubview</span><span class="o">:</span><span class="w"> </span><span class="n">labelTime</span><span class="p">];</span>
<span class="w">   </span><span class="p">[</span><span class="n">box</span><span class="w"> </span><span class="n">addSubview</span><span class="o">:</span><span class="w"> </span><span class="n">localDate</span><span class="p">];</span>
<span class="w">   </span><span class="p">[</span><span class="n">box</span><span class="w"> </span><span class="n">addSubview</span><span class="o">:</span><span class="w"> </span><span class="n">localTime</span><span class="p">];</span>
<span class="w">   </span><span class="n">RELEASE</span><span class="p">(</span><span class="n">clockView</span><span class="p">);</span>
<span class="w">   </span><span class="n">RELEASE</span><span class="p">(</span><span class="n">labelDate</span><span class="p">);</span>
<span class="w">   </span><span class="n">RELEASE</span><span class="p">(</span><span class="n">labelTime</span><span class="p">);</span>
<span class="w">   </span><span class="n">RELEASE</span><span class="p">(</span><span class="n">localDate</span><span class="p">);</span>
<span class="w">   </span><span class="n">RELEASE</span><span class="p">(</span><span class="n">localTime</span><span class="p">);</span>

<span class="w">   </span><span class="p">[</span><span class="nb">self</span><span class="w"> </span><span class="n">addSubview</span><span class="o">:</span><span class="w"> </span><span class="n">box</span><span class="p">];</span>
<span class="w">   </span><span class="n">RELEASE</span><span class="p">(</span><span class="n">box</span><span class="p">);</span>
<span class="w">   </span><span class="p">[[</span><span class="bp">NSNotificationCenter</span><span class="w"> </span><span class="n">defaultCenter</span><span class="p">]</span><span class="w"> </span><span class="n">addObserver</span><span class="o">:</span><span class="w"> </span><span class="nb">self</span>
<span class="w">                                            </span><span class="nl">selector</span><span class="p">:</span><span class="w"> </span><span class="k">@selector</span><span class="p">(</span><span class="n">setDate</span><span class="o">:</span><span class="p">)</span>
<span class="w">                                                </span><span class="nl">name</span><span class="p">:</span><span class="w"> </span><span class="s">@&quot;TimeViewShouldUpdateCurrentTime&quot;</span>
<span class="w">                                              </span><span class="nl">object</span><span class="p">:</span><span class="w"> </span><span class="nb">nil</span><span class="p">];</span>
<span class="w">   </span><span class="p">[</span><span class="nb">self</span><span class="w"> </span><span class="n">showCurrentTime</span><span class="o">:</span><span class="w"> </span><span class="nb">self</span><span class="p">];</span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="nb">self</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Only one line is needed for register. It specify what object to receive
the notification (addObserver:), which method to handle the notification
(selector:), what’s the name of notification (name:), and what’s the
object of the notification. It is important that the name of
notification should be the same as what the speaker use. So once the
speaker say “TimeViewShouldUpdateCurrentTime”, the objects which
register them using “TimeViewShouldUpdateCurrentTime” will receive the
notification, and the selector will be called. The “object: nil” means
that this object accept all the notification with the name
“TimeViewShouldUpdateCurrentTime” no matter what kind of object it
carries on.</p>
<p>Now, I register the TimeView for the notification
“TimeViewShouldUpdateCurrentTime”. Once the speaker speak, the method
-setDate: will be called. So I need to set up this method.</p>
<p><code class="docutils literal notranslate"><span class="pre">TimeView.m:</span></code></p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">setDate:</span><span class="w"> </span><span class="p">(</span><span class="bp">NSNotification</span><span class="w"> </span><span class="o">*</span><span class="p">)</span> <span class="nv">not</span>
<span class="p">{</span>
<span class="w">   </span><span class="n">ASSIGN</span><span class="p">(</span><span class="n">date</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">not</span><span class="w"> </span><span class="n">object</span><span class="p">]);</span>
<span class="w">   </span><span class="p">[</span><span class="n">date</span><span class="w"> </span><span class="n">setTimeZone</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="bp">NSTimeZone</span><span class="w"> </span><span class="n">timeZoneWithName</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="n">box</span><span class="w"> </span><span class="n">title</span><span class="p">]]];</span>
<span class="w">   </span><span class="p">[</span><span class="n">date</span><span class="w"> </span><span class="n">setCalendarFormat</span><span class="o">:</span><span class="w"> </span><span class="s">@&quot;%a, %b %e, %Y&quot;</span><span class="p">];</span>
<span class="w">   </span><span class="p">[</span><span class="n">localDate</span><span class="w"> </span><span class="n">setStringValue</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="n">date</span><span class="w"> </span><span class="n">description</span><span class="p">]];</span>
<span class="w">   </span><span class="p">[</span><span class="n">date</span><span class="w"> </span><span class="n">setCalendarFormat</span><span class="o">:</span><span class="w"> </span><span class="s">@&quot;%H : %M : %S&quot;</span><span class="p">];</span>
<span class="w">   </span><span class="p">[</span><span class="n">localTime</span><span class="w"> </span><span class="n">setStringValue</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="n">date</span><span class="w"> </span><span class="n">description</span><span class="p">]];</span>
<span class="w">   </span><span class="p">[</span><span class="n">clockView</span><span class="w"> </span><span class="n">setDate</span><span class="o">:</span><span class="w"> </span><span class="n">date</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>I reuse the -setDate in previous lesson, but change the interface
because right now, it is called by notification center. And I can get
the object the notification carries on by using [NSNotification
object] method.</p>
<p>Finally, I need to remove the observer from notification center when it
is released. Otherwise, it causes problems. So here is the -dealloc.</p>
<p><code class="docutils literal notranslate"><span class="pre">TimeView.m:</span></code></p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">dealloc</span>
<span class="p">{</span>
<span class="w">   </span><span class="p">[[</span><span class="bp">NSNotificationCenter</span><span class="w"> </span><span class="n">defaultCenter</span><span class="p">]</span><span class="w"> </span><span class="n">removeObserver</span><span class="o">:</span><span class="w"> </span><span class="nb">self</span><span class="p">];</span>
<span class="w">   </span><span class="n">RELEASE</span><span class="p">(</span><span class="n">date</span><span class="p">);</span>
<span class="w">   </span><span class="p">[</span><span class="nb">super</span><span class="w"> </span><span class="n">dealloc</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To sum up, the speaker speak to notification center with a specific name
of notification, and may or may not carry an object with the
notification. The audience register themselves to notification center
with what kinds of notification they want to receive by the name of
notification. When notification center get the notification, it will
call the registered method in the audience.</p>
<p>There are some source codes needed to be modified due to the change of
setDate: method. They are not shown here, and it’s not hard to figure
them out.</p>
<p>Since I can update all the clocks manually, I can do it automatically.
NSTimer is a timer which can trigger an action after a given time
repeatly or not. Here, I’ll use a NSTimer to make the clock “run”.</p>
<p>I need to add new submenu: “Timer”, and two menu item: “Start” and
“Stop”. Add two action in class “Controller”: “startTimer:” and
“stopTimer:”. Then connect the menu item to the action. This should be
very easy now.</p>
<p><span id="AEN884"></span></p>
<p><strong>Figure 4-31. Connect menu action</strong></p>
<p><img alt="" src="../../../_images/Notification-01.jpg" /></p>
<p><img alt="" src="../../../_images/Notification-02.jpg" /></p>
<p><img alt="" src="../../../_images/Notification-03.jpg" /></p>
<p>Add these two actions and a NSTimer in Controller.</p>
<p><code class="docutils literal notranslate"><span class="pre">Controller.h:</span></code></p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="cp">#import &lt;AppKit/AppKit.h&gt;</span>
<span class="cp">#import &quot;TimeView.h&quot;</span>

<span class="k">@interface</span> <span class="nc">Controller</span> : <span class="bp">NSObject</span>
<span class="p">{</span>
<span class="w">   </span><span class="kt">id</span><span class="w"> </span><span class="n">timeView</span><span class="p">;</span>
<span class="w">   </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">totalNumber</span><span class="p">;</span>
<span class="w">   </span><span class="bp">NSTimer</span><span class="w"> </span><span class="o">*</span><span class="n">timer</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">showCurrentTime:</span><span class="w"> </span><span class="p">(</span><span class="kt">id</span><span class="p">)</span> <span class="nv">sender</span><span class="p">;</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">addClock:</span><span class="w"> </span><span class="p">(</span><span class="kt">id</span><span class="p">)</span> <span class="nv">sender</span><span class="p">;</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">deleteClock:</span><span class="w"> </span><span class="p">(</span><span class="kt">id</span><span class="p">)</span> <span class="nv">sender</span><span class="p">;</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">startTimer:</span><span class="w"> </span><span class="p">(</span><span class="kt">id</span><span class="p">)</span> <span class="nv">sender</span><span class="p">;</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">stopTimer:</span><span class="w"> </span><span class="p">(</span><span class="kt">id</span><span class="p">)</span> <span class="nv">sender</span><span class="p">;</span>
<span class="k">@end</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Controller.m:</span></code></p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">startTimer:</span><span class="w"> </span><span class="p">(</span><span class="kt">id</span><span class="p">)</span> <span class="nv">sender</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">timer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="bp">NSTimer</span><span class="w"> </span><span class="n">scheduledTimerWithTimeInterval</span><span class="o">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                                           </span><span class="nl">target</span><span class="p">:</span><span class="w"> </span><span class="nb">self</span>
<span class="w">                                         </span><span class="nl">selector</span><span class="p">:</span><span class="w"> </span><span class="k">@selector</span><span class="p">(</span><span class="n">showCurrentTime</span><span class="o">:</span><span class="p">)</span>
<span class="w">                                         </span><span class="nl">userInfo</span><span class="p">:</span><span class="w"> </span><span class="nb">nil</span>
<span class="w">                                          </span><span class="nl">repeats</span><span class="p">:</span><span class="w"> </span><span class="nb">YES</span><span class="p">];</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">stopTimer:</span><span class="w"> </span><span class="p">(</span><span class="kt">id</span><span class="p">)</span> <span class="nv">sender</span>
<span class="p">{</span>
<span class="w">  </span><span class="p">[</span><span class="n">timer</span><span class="w"> </span><span class="n">invalidate</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>That’s all. In NSTimer, set the interval, target, selector (action), and
repeats. Then it will trigger the action -showCurrentTime: every second.
Use -invalidate to stop the timer. Generally, you need to write a thread
in order not to block the user interface. But with the help of timer,
you can totally avoid this problem. Finger (in gnustep/usr-apps/) is
another good example how to avoid thread using non-blocking I/O.</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Since timer is autoreleased, it might disappear anytime in this example, which causes serious memory problem, and usually make application unstable. It would be better to retain the timer in <code class="docutils literal notranslate"><span class="pre">-startTimer:</span></code> and release it in <code class="docutils literal notranslate"><span class="pre">-stopTimer:</span></code>, and to ensure that only one timer exist when user click the “start” menu more than once.</p>
</div>
<hr class="docutils" />
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#single-window-application"><span id="AEN503">Single Window Application</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#outlet-and-action"><span id="AEN506">Outlet and Action</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#custom-view"><span id="AEN622">Custom View</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#drawing"><span id="AEN707">Drawing</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#panel"><span id="AEN728">Panel</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#notification"><span id="AEN836">Notification</span></a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../../../_sources/Guides/App/3_TimeMachine/Staging.md.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="../../../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024, GNUstep contributors.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.0.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>